<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Task 상세 화면</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f4f6f9;
            margin: 0;
            padding: 2rem;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background-color: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        textarea {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
        }
        button {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border: none;
            border-radius: 4px;
        }
        .edit-btn {
            background-color: #4CAF50;
            color: white;
        }
        .delete-btn {
            background-color: #ff4d4f;
            color: white;
        }
        .comment-section {
            margin-top: 3rem;
        }
        .comment {
            border-top: 1px solid #ddd;
            padding: 1rem 0;
        }
        .comment p {
            margin: 0;
            white-space: pre-wrap;
        }
        .comment-meta {
            font-size: 0.9rem;
            color: gray;
            margin-top: 0.5rem;
        }
        .comment-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>

<div class="container">

    <!-- ✅ Task 제목 -->
    <h1 th:text="${task.taskTitle}" style="margin-bottom: 1rem;">Task 제목</h1>

    <!-- ✅ Milestone, Tag 보여주기 -->
    <div style="margin-bottom: 2rem;">
        <!-- Milestone 표시 -->
        <div th:if="${task.milestone != null}" style="font-size: 1rem; margin-bottom: 0.5rem;">
            <strong>마일스톤:</strong> <span th:text="${task.milestone.milestoneName}">Milestone 이름</span>
        </div>

        <!-- Tag 목록 표시 -->
        <div th:if="${tags != null}" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
            <span th:each="tag : ${tags}"
                  style="background-color: #e0f7fa; color: #00796b; padding: 0.3rem 0.6rem; border-radius: 12px; font-size: 0.9rem;"
                  th:text="${tag.tagName}">
                태그 이름
            </span>
        </div>
    </div>

    <!-- ✅ Task 본문 내용 -->
    <div style="margin-bottom: 2rem; white-space: pre-wrap;">
        <p th:text="${task.taskDescription}">Task 내용</p>
    </div>

    <!-- ✅ 수정/삭제 버튼 -->
    <div style="display: flex; gap: 1rem; margin-bottom: 3rem;">
        <form th:action="@{/task/{taskId}/edit(taskId=${task.taskId})}" method="get">
            <button type="submit" class="edit-btn">수정</button>
        </form>
        <form th:action="@{/task/{taskId}/delete(taskId=${task.taskId})}" method="post" style="margin: 0;">
            <input type="hidden" name="_method" value="delete"/>
            <button type="submit" class="delete-btn">삭제</button>
        </form>
    </div>

    <hr style="margin-bottom: 2rem;">

    <!-- ✅ 댓글 등록 폼 -->
    <form th:action="@{/project/{projectId}/task/{taskId}/comment(projectId=${projectId}, taskId=${task.taskId})}" method="post" class="comment-section">
        <textarea name="commentContent" rows="3" placeholder="댓글을 입력하세요"></textarea>
        <button type="submit" class="edit-btn" style="margin-top: 0.5rem;">댓글 등록</button>
    </form>

    <!-- ✅ 댓글 목록 -->
    <div class="comment-section">
        <h3>댓글</h3>
        <div th:each="comment : ${comments}" class="comment">
            <p th:text="${comment.commentContent}">댓글 내용</p>

            <!-- ✅ 댓글 작성자 표시 -->
            <div class="comment-meta">
                작성자: <span th:text="${comment.commentWriterId}">작성자</span>
            </div>

            <!-- ✅ 자기 댓글이면 수정/삭제 버튼 노출 -->
            <div class="comment-actions" th:if="${comment.commentWriterId == loginUserId}">
                <form th:action="@{/task/{taskId}/comments/{commentId}/edit(taskId=${task.id}, commentId=${comment.id})}" method="get">
                    <button type="submit" class="edit-btn" style="padding: 0.3rem 0.7rem;">댓글 수정</button>
                </form>
                <form th:action="@{/task/{taskId}/comments/{commentId}/delete(taskId=${task.id}, commentId=${comment.id})}" method="post" style="margin: 0;">
                    <input type="hidden" name="_method" value="delete"/>
                    <button type="submit" class="delete-btn" style="padding: 0.3rem 0.7rem;">댓글 삭제</button>
                </form>
            </div>
        </div>
    </div>

</div>

</body>
</html>
